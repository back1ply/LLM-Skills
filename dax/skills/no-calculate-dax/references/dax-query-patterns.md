# DAX Query View Patterns

The **DAX Query View** is the best place to write, test, and debug "No CALCULATE" measures. It allows you to see the intermediate tables that your variables act upon.

> **See also**: [Debugging Techniques](./debugging.md) for step-by-step debugging workflows and TOCSV patterns.

---

## Basic Query Structure

Every DAX query must start with `EVALUATE`. `DEFINE` is optional but used for variables and measures.

```dax
DEFINE
    VAR __Value = 100
    
EVALUATE
    { __Value }  -- Return a scalar as a 1-row table
```

---

## Testing a Metric (The "Harness" Pattern)

Test a specific measure logic for a specific customer/product without slicing a visual.

```dax
DEFINE
    -- 1. Simulate the Filter Context
    VAR __FilterCustomer = "Customer A"
    VAR __FilterYear = 2024
    
    -- 2. Define the Logic (Your Measure Code)
    VAR __Table = FILTER( 'Sales', 
        'Sales'[Customer] = __FilterCustomer && 
        YEAR( 'Sales'[Date] ) = __FilterYear 
    )
    VAR __Result = SUMX( __Table, [Amount] )

EVALUATE
    -- 3. Output the Result
    { ( "Result", __Result ) }
```

---

## Debugging Intermediate Tables

The power of "No CALCULATE" is that `__Table` variables are real tables. You can `EVALUATE` them to see exactly what rows are being summed.

```dax
DEFINE
    VAR __FilterColor = "Red"
    
    -- The table variable you want to inspect
    VAR __DebugTable = 
        ADDCOLUMNS(
            FILTER( 'Products', 'Products'[Color] = __FilterColor ),
            "__Sales", [Total Sales]
        )

EVALUATE
    TOPN( 100, __DebugTable, [__Sales], DESC )
```

---

## Testing Measures in Bulk

Check if precision or logic holds up across multiple categories.

```dax
DEFINE
    MEASURE 'Sales'[Test Margin] = DIVIDE( [Total Sales] - [Total Cost], [Total Sales], 0 )

EVALUATE
    SUMMARIZECOLUMNS(
        'Product'[Category],
        "Sales", [Total Sales],
        "Test Margin", [Test Margin]
    )
ORDER BY 
    'Product'[Category] ASC
```

---

## Quick Queries

Shortcuts for knowing your data.

### Distinct Values

```dax
EVALUATE VALUES( 'Product'[Color] )
```

### Table Stats

```dax
EVALUATE 
    { 
        ( "Rows", COUNTROWS( 'Sales' ) ), 
        ( "Min Date", MIN( 'Sales'[Date] ) ), 
        ( "Max Date", MAX( 'Sales'[Date] ) ) 
    }
```

---

## Best Practices

1. **Write here first**: Don't write complex measures in the little formula bar. Write them here, `EVALUATE` the variables to prove they work, then copy-paste to the model.
2. **Format Query**: Use the "Format Query" button (Shift+Alt+F) to keep code readable.
3. **Performance Analyzer**: You can copy queries generated by Performance Analyzer and paste them here to optimize.
